@model AppointmentSystem.Models.ViewModels.HomeModels.IndexVM

@{
    Layout = "~/Views/Shared/_Layout.cshtml";
    ViewData["Title"] = "後臺首頁";
}
<style>
    /* .appointmentTable {
        border-collapse: separate;
        border-spacing: 0px;
        width: 100%;
        // max-width: 800px; 
        margin: 0 auto;
        display: block;
        overflow-x: auto;
        white-space: nowrap;
        background-color: white;
        border-radius: 13px;
        padding: 10px;
        border: none;
        min-height: 350px;
        box-shadow: 0px 5px 15px rgba(0, 0, 0, 0.3);
    } */

    .appointmentTable {
        border-collapse: separate;
        border-spacing: 0px;
        width: 100%;
        /* max-width: 800px; */
        margin: 0 auto;
        display: block;
        overflow-x: auto;
        overflow-y: auto; /* 允許垂直滾動 */
        white-space: nowrap;
        background-color: white;
        border-radius: 13px;
        padding: 10px;
        border: none;
        height: 550px; /* 固定高度 */
        box-shadow: 0px 5px 15px rgba(0, 0, 0, 0.3);
    }

    .tableHeader {
        border-right: 1px solid #E7DCD9;
        padding: 3px;
        text-align: left;
        vertical-align: middle;
        height: 30px;
        position: relative;
        background-color: #385466;
        font-weight: normal;
        color: #ffffff;
        text-align: left;
        width: 200px;
        display: inline-block;
        font-size: 16px;
    }

    .appointmentTable td {
        border-right: 1px solid #E7DCD9;
        border-bottom: 1px solid #E7DCD9;
        border-top: 1px solid #dbc8b6;
        padding: 10px;
        text-align: center;
        vertical-align: middle !important;
        width: 200px;
        height: 120px;
        position: relative;
        display: inline-block;
        background-color: #F7F6EE;
    }

    .event {
        position: absolute;
        background-color: #FFFFFF;
        color: #385466;
        padding-left: 10px;
        padding-right: 10px;
        padding-top: 5px;
        padding-bottom: 10px;
        border-radius: 5px;
        font-size: 0.9em;
        box-shadow: 0px 5px 15px rgba(0, 0, 0, 0.3);
        left: 5px;
        /* right: 0%; */ 
        height: 96%; /* 延伸到下一個單元格 */
        z-index: 1;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        cursor: pointer;
    }

    .outpatient-td {
        align-content: center !important;
        text-align: center !important;
        font-size: 16px;
    }

    .appointmentTime {
        margin-bottom: 5px;
    }

    .treatmentItem {
        border: 1px;
        border-radius: 12px;
        display: inline-block;
        width: fit-content;
        background-color: #F7F6EE;
        color: #385466;
        padding-left: 5px;
        padding-right: 5px;
    }

    .appointmentDetail {
        background-color: #F7F6EE;
        transition: .4s;
        border-radius: 20px;
        padding-top: 10px;
        margin: auto;
        min-height: 300px;
        box-shadow: 0px 5px 15px rgba(0, 0, 0, 0.3);
    }

    .userinfo-sidebar {
        text-align: center;
        vertical-align: central;
        display: none;
    }

        .userinfo-sidebar h5 {
            margin-bottom: 0;
        }

        .userinfo-sidebar p {
            margin-bottom: 10px;
        }


    .userinfo-item {
        display: flex;
        justify-content: center;
        margin-top: 10px;
        margin-bottom: 10px;
    }

    #actualList label {
        border-radius: 10px !important;
        margin: 3px;
    }

    .userinfo-item button {
        background-color: #385466 !important;
        color: #F7F6EE !important;
        border-radius: 10px !important;
    }

    .userinfo-item .gender, .userinfo-item .age {
        background-color: #7B7373;
        color: white;
        border-radius: 10px;
        margin-left: 10px;
        margin-right: 10px;
        padding-left: 20px;
        padding-right: 20px;
    }

    .sidebarbtn {
        background-color: #a9a9a9;
        border: none;
        margin: 2px;
        border-radius: 5px;
    }


    .switch {
        position: relative;
        display: inline-block;
        width: 34px;
        height: 20px;
    }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

    .slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: #ccc;
        transition: .4s;
        border-radius: 34px;
    }

        .slider:before {
            position: absolute;
            content: "";
            height: 14px;
            width: 14px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

    input:checked + .slider {
        background-color: #2196F3;
    }

        input:checked + .slider:before {
            transform: translateX(14px);
        }

    .treatmentSelectMenu {
        display: none;
        position: absolute;
        top: 50%;
        left: -110%;
        background-color: #d3d3d3;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        width: 300px;
        transform: translateX(20px);
        z-index: 9999;
    }


    /*.treatmentSelectMenu button {
                                                                background-color: #385460 !important;
                                                                color: #F7F6EE !important;
                                                                border-radius: 10px !important;
                                                            }


                                                        .appointmentDetail label {
                                                            background-color: #385466 !important;
                                                            color: #F7F6EE !important;
                                                            border-radius: 10px !important;
                                                        }
                                                           .treatmentSelectMenu  label {
                                                            background-color: #385466 !important;
                                                            color: #F7F6EE !important;
                                                            border-radius: 10px !important;
                                                        }

                                                        .treatmentSelectMenu label:focus,
                                                        .treatmentSelectMenu label:hover,
                                                        .treatmentSelectMenu label:active {
                                                            background-color: #2A3A4A !important;
                                                            color: #FFFFFF !important;
                                                        }

                                                        .treatmentSelectMenu label.selected {
                                                            background-color: #2A3A4A !important;
                                                            color: #FFFFFF !important;
                                                        }
                                                    .label-item, .treatment-item, actualTreatment-item {
                                                        margin-bottom: 10px !important;
                                                    }

                                                    */

    .date-input {
        width: 200px;
        border: 1px solid #ccc;
        border-radius: 13px;
        padding-top: 3px;
        padding-bottom: 3px;
        padding-left: 3px;
        padding-right: 8px;
        margin-right: 5px;
        text-align: center;
        font-size: 14px;
        box-shadow: 0px 1px 3px rgba(0, 0, 0, 0.1);
        -moz-appearance: textfield; /* For Firefox */
    }

        /* .date-input#currentMonth, .date-input#currentDay {
                                                    width: 50px;
                                                } */

        .date-input::-webkit-inner-spin-button,
        .date-input::-webkit-outer-spin-button {
            opacity: 1; /* Ensure the spinner buttons are visible */
            background: transparent !important;
        }


        .date-input[readonly] {
            background-color: #f9f9f9; /* Optional: change background color to indicate readonly state */
            cursor: not-allowed;
        }

    .date-label {
        font-size: 14px;
        margin-right: 10px;
    }

    input[type=number]::-webkit-outer-spin-button,
    input[type=number]::-webkit-inner-spin-button {
        background: none;
    }

    /* 針對 Firefox */
    input[type=number] {
        background: none;
    }

    .active {
        background-color: #5BC2E7 !important;
        border: none;
    }

    .datepicker {
        border-radius: 10px;
        padding: 20px;
        width: 100%;
        max-width: 100%;
        box-sizing: border-box;
    }

    .datepicker-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
    }

        .datepicker-header div {
            cursor: pointer;
            padding: 1px;
        }

            .datepicker-header div:hover {
                background-color: #eee;
            }

        .datepicker-header span {
            font-size: 18px;
            font-weight: bold;
        }

    .datepicker-body {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: 10px;
    }

        .datepicker-body div {
            text-align: center;
            padding: 10px;
            cursor: pointer;
            border-radius: 100px;
            transition: background-color 0.3s, color 0.3s;
        }

        .datepicker-body .header {
            font-weight: bold;
            color: #666666;
        }

        .datepicker-body div:hover {
            background-color: #eee;
        }

        .datepicker-body .disabled {
            color: #ccc;
            cursor: not-allowed;
        }

        .datepicker-body .availabel {
            color: black;
            cursor: pointer;
        }

            .datepicker-body .availabel:hover {
                background-color: #bcbcbc;
            }

        .datepicker-body .selected {
            background-color: #d9534f;
            color: white;
        }
</style>

<h3 class="container " style="text-align:start; margin:10px;">@ViewData["Title"]</h3>

<div class="row">
    <div class="col-9">
        <div style="width:100%;align-items:center;text-align:center;font-size:16px;margin-bottom:10px;">
            <input type="text" id="currentDate" class="date-input" style="cursor:pointer;" data-toggle="modal" data-target="#calendarModal" />
            @* <input type="number" id="currentYear" class="date-input" min="1900" max="2100" />
            <label class="date-label" for="currentYear">年</label>
            <input type="number" id="currentMonth" class="date-input" min="1" max="12" />
            <label class="date-label" for="currentMonth">月</label>
            <input type="number" id="currentDay" class="date-input" min="1" max="31" />
            <label class="date-label" for="currentDay">日</label>
            <button class="btn btn-primary" style="border:none; background-color:transparent; padding:0px;" onclick="refreshTable();"> <img src="~/images/refresh_24dp_4A707A_FILL0_wght400_GRAD0_opsz24.png" alt="Refresh" style="width:25px;height:25px; " /></button> *@
        </div>
        <table class="appointmentTable">
        </table>
    </div>
    <div class="col-2 appointmentDetail" id="appointmentDetail">
        <div class="userinfo-sidebar">
            <h5 id="name"></h5>
            <div class="userinfo-item">
                <div class="gender" id="gender"></div>
                <div class="age" id="age"></div>
            </div>

            <div id="medicalRecordNumber">病歷號：</div>
            <div id="phone">電話號碼：</div>
            <div id="birth">生日：</div>
            <div id="email">電子郵件：</div>

            <div class="userinfo-item" style="margin-bottom:30px;">
                <button class="btn sidebarbtn" style="background-color:#385466;color:#F7F6EE; border-radius:10px;" onclick="showEditCustomerInfoModal();">編輯</button>
            </div>

            <div class="userinfo-item">

                <div id="editAppointment">
                    <button class="btn sidebarbtn">修改預約</button>
                </div>

                <div id="cancelAppointment">
                    <button class="btn sidebarbtn" style="background-color:#385466;color:#F7F6EE; border-radius:10px;" onclick="appointmentCancel();">取消預約</button>
                </div>
            </div>

            <div class="userinfo-item">
                <div id="checkIn"></div>
            </div>

            <div class="userinfo-item">

                <span class="missed">未報到次數:0</span>
            </div>

            <div class="userinfo-item" style="margin-top:30px;">
                <span>實際施作項目</span>
            </div>

            <div class="userinfo-item">
                <div id="actualList" class="btn-group-toggle" data-toggle="buttons">
                    <label class="btn btn-secondary btn-checkbox label-item" style="cursor:pointer; border-radius:13px;">
                        <input type="checkbox" name="labels" id="dfg" value="sdfg" autocomplete="off">xcvbsdg
                        <input type="hidden" id="xcvb" value="sdfgxcb" />
                    </label>
                </div>
            </div>

            <button class="btn btn-primary" onclick="showTreatmentSelectMenu();" style="font-size: 14px; background-color:transparent; border:none;">
                <img src="/images/add_circle_16dp_049FBF_FILL0_wght400_GRAD0_opsz20.png" style="width:40px;height:40px ;" \>
            </button>

            <div class="treatmentSelectMenu" id="treatmentSelectMenu">
                <h6>標籤列表</h6>
                <div id="labelList" class="btn-group-toggle" data-toggle="buttons">
                    @{
                        int i = 0;
                    }

                    @foreach (var label in Model.LabelList)
                    {
                        i++;

                        <label class="btn btn-secondary btn-checkbox label-item" style="cursor:pointer;margin:3px; border-radius:13px;">
                            <input type="checkbox" name="labels" id="@label.LabelId" value="@label.LabelId" autocomplete="off">@label.LabelName
                            <input type="hidden" id="tl-@i" value="@label.TreatmentIdList" />
                        </label>
                    }
                </div>
                <h6 style="margin-top:30px">療程列表</h6>
                <div id="treatmentList" class="btn-group-toggle" data-toggle="buttons">
                    @foreach (var treatment in Model.TreatmentList)
                    {
                        <label class="btn btn-secondary btn-checkbox treatment-item" style="cursor:pointer;margin:3px; border-radius:13px;">
                            <input type="checkbox" name="treatments" id="@treatment.TreatmentId" value="@treatment.TreatmentId" autocomplete="off">@treatment.TreatmentName
                        </label>
                    }
                </div>
                <p></p>
                <button class="btn btn-primary" style="cursor:pointer;margin:3px; border-radius:13px;" onclick="saveSelectedTreatment();">確定</button>
            </div>

        </div>
    </div>
</div>

<div class="modal fade" id="editCustomerInfoModal" tabindex="-1" aria-labelledby="ModalInfo" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="ModalTitle">編輯客戶資料</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="customerMedicalRecordNumber">病歷號：</label>
                    <input type="text" class="form-control" id="customerMedicalRecordNumber" required>
                </div>
                <div class="form-group">
                    <label for="customerName">客戶名稱：</label>
                    <input type="text" class="form-control" id="customerName" required>
                </div>
                <div class="form-group">
                    <label for="customerCellPhone">手機號碼：</label>
                    <input type="text" class="form-control" id="customerCellPhone" required>
                </div>
                <div class="form-group">
                    <label for="customerBirth">生日：</label>
                    <input type="date" class="form-control" id="customerBirth" required>
                </div>
                <div class="form-group">
                    <label for="customerEmail">電子郵件：</label>
                    <input type="text" class="form-control" id="customerEmail" required>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">取消</button>
                <button type="button" class="btn btn-primary" id="submitBtn" onclick="editCustomerInfo();">送出</button>
            </div>
        </div>
    </div>
</div>

<!-- 日期選擇的Modal -->
<div id="calendarModal" class="modal fade" tabindex="-1" aria-labelledby="calendarModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content datepicker">
            <div class="modal-header datepicker-header">
                <div id="prevMonth">&lt;</div>
                <span id="monthYear"></span>
                <div id="nextMonth">&gt;</div>
            </div>
            <div class="modal-body datepicker-body" id="calendar"></div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">關閉</button>
            </div>
        </div>
    </div>
</div>

<input type="hidden" id="selectedAppointment" value="" />

<script>
    let today = new Date();
    let currentYear = today.getFullYear();
    let currentMonth = today.getMonth();
    let currentDay = today.getDate();
    let selectedDate = null;

    $(document).ready(function () {
        init();

        function init() {
            // $('#currentYear').val(currentYear);
            // $('#currentMonth').val(currentMonth + 1);
            // $('#currentDay').val(currentDay);

            $('#currentDate').val(currentYear + "-" + (currentMonth + 1) + "-" + currentDay);

            setAppointmentTable(currentYear, currentMonth, currentDay);
        }

        // $('.appointmentTable').on('mousewheel', function (event) {
        //     if (event.originalEvent.deltaY) {
        //         this.scrollLeft += (event.originalEvent.deltaY > 0 ? 1 : -1) * 100;
        //         event.preventDefault();
        //     }
        // });

        $("label.label-item").click(function () {
            $(this).toggleClass("active");
            setTimeout(setTreatmentList, 0);
        });
    });

    const monthNames = ["一月", "二月", "三月", "四月", "五月", "六月", "七月", "八月", "九月", "十月", "十一月", "十二月"];
    const daysOfWeek = ["日", "一", "二", "三", "四", "五", "六"];

    function generateCalendar(year, month) {
        const monthYear = $('#monthYear');
        const calendar = $('#calendar');
        calendar.empty();

        let firstDay = new Date(year, month).getDay();
        let daysInMonth = 32 - new Date(year, month, 32).getDate();

        monthYear.text(`${monthNames[month]} ${year}`);

        for (let day of daysOfWeek) {
            let dayElement = $('<div>').text(day).addClass('header');
            calendar.append(dayElement);
        }

        for (let i = 0; i < firstDay; i++) {
            let emptyCell = $('<div>');
            calendar.append(emptyCell);
        }

        for (let date = 1; date <= daysInMonth; date++) {
            let dateElement = $('<div>').text(date);

            let dateToCheck = new Date(year, month, date);
            let dateString = `${year}-${String(month + 1).padStart(2, '0')}-${String(date).padStart(2, '0')}`;

            dateElement.data('date', dateString);
            dateElement.addClass('availabel');

            // 添加點擊事件
            dateElement.on('click', function () {
                if (selectedDate) {
                    selectedDate.removeClass('selected');
                }
                dateElement.addClass('selected');
                selectedDate = dateElement;

                // 更新 input 的值
                $('#currentDate').val(dateString);
                // 隱藏 modal
                $('#calendarModal').modal('hide');

                refreshTable();
            });

            calendar.append(dateElement);
        }
    }

    function updateCalendar() {
        generateCalendar(currentYear, currentMonth);
    }

    $('#prevMonth').on('click', function () {
        if (currentMonth === 0) {
            currentMonth = 11;
            currentYear--;
        } else {
            currentMonth--;
        }
        updateCalendar();
    });

    $('#nextMonth').on('click', function () {
        if (currentMonth === 11) {
            currentMonth = 0;
            currentYear++;
        } else {
            currentMonth++;
        }
        updateCalendar();
    });

    $('#calendarModal').on('shown.bs.modal', function () {
        updateCalendar();
    });

    function appointmentOnClick(appointmentId) {
        $.ajax({
            type: 'POST',
            url: '/Home/SetAppointmentDetail',
            datatype: "json",
            data: { "appointmentId": appointmentId },
            success: function (data) {

                $('#selectedAppointment').val(appointmentId);
                $('#gender').html(data.customerData.gender);
                $('#age').html(data.customerData.age);
                $('#missed').html(data.customerData.missed);

                $('#name').html(data.customerData.name);
                $('#customerName').val(data.customerData.name);

                $('#medicalRecordNumber').html("病歷號：" + data.customerData.medicalRecordNumber);
                $('#customerMedicalRecordNumber').val(data.customerData.medicalRecordNumber);

                $('#phone').html("電話號碼：" + data.customerData.cellPhone);
                $('#customerCellPhone').val(data.customerData.cellPhone);

                $('#birth').html("生日：" + data.customerData.birthday);
                $('#customerBirth').val(data.customerData.birthday);

                $('#email').html("電子郵件：" + data.customerData.email);
                $('#customerEmail').val(data.customerData.email);


                if (data.checkIn == "Y") {
                    $('#checkIn').html('<button class="btn sidebarbtn" disabled>已報到</button>');
                } else {
                    $('#checkIn').html('<button class="btn sidebarbtn" onclick="appointmentCheckIn();">預約報到</button>');
                }

                $('#editAppointment').html('<button class="btn sidebarbtn" onclick="editAppointment();">修改預約</button>');

                let inner = ``;
                data.actualTreatmentData.forEach(function (x) {
                    inner += `<label class="btn btn-secondary btn-checkbox actualTreatment-item" style="cursor:pointer;">`;
                    inner += `<input type="checkbox" name="labels" autocomplete="off">` + x.treatmentName;
                    inner += `</label>`;
                });
                $('#actualList').html(inner);

                $('.userinfo-sidebar').show();
            }
        });
    }

    function showEditCustomerInfoModal() {
        let Id = $('#selectedAppointment').val();

        if (Id == "")
            return false;
        else {
            $('#editCustomerInfoModal').modal('show');
        }
    }

    function editCustomerInfo() {
        let id = $('#selectedAppointment').val();
        let customerMedicalRecordNumber = $('#customerMedicalRecordNumber').val();
        let customerName = $('#customerName').val();
        let customerCellPhone = $('#customerCellPhone').val();
        let customerBirth = $('#customerBirth').val();
        let customerEmail = $('#customerEmail').val();

        $.ajax({
            type: "POST",
            url: "/Home/editCustomerInfo",
            datatype: "json",
            data: { "appointmentId": id, "customerMedicalRecordNumber": customerMedicalRecordNumber, "customerName": customerName, "customerCellPhone": customerCellPhone, "customerBirth": customerBirth, "customerEmail": customerEmail },
            success: function (data) {
                console.log("Create label successful.");

                $('#editCustomerInfoModal').modal('hide');
                appointmentOnClick(id);
                refreshTable();
            }
        });
    }

    function setAppointmentTable(currentYear, currentMonth, currentDay) {
        $.ajax({
            type: 'POST',
            url: '/Home/SetAppointmentTable',
            datatype: "json",
            data: { "currentYear": currentYear, "currentMonth": currentMonth + 1, "currentDay": currentDay },
            success: function (data) {
                console.log(data)
                let appointmentTable = $('.appointmentTable');
                let innerHTML = ``;
                let outpatientCount = data.outpatientTimeDatas.length;

                // 設定每位醫師的表頭
                innerHTML += `<tr>`;
                innerHTML += `<th class="tableHeader"></th>`;
                data.doctorDatas.forEach(function (item) {
                    innerHTML += `<th class="tableHeader">` + item.doctorName + `</th>`;
                });
                innerHTML += `</tr>`;

                //設定門診時段資料

                if (data.outpatientTimeDatas.length > 0) {
                    data.outpatientTimeDatas.forEach(function (item) {
                        innerHTML += `<tr>`;
                        innerHTML += `<td class="outpatient-td">` + item.beginTime + `</td>`;

                        data.doctorDatas.forEach(function (x) {
                            innerHTML += `<td id="` + x.doctorId + `-` + item.beginTime.toString().replace(':', '') + `"></td>`;
                        });
                        innerHTML += `</tr>`;
                    });
                } else {
                    innerHTML += `<tr>`;
                    innerHTML += `<td class="outpatient-td"></td>`;

                    data.doctorDatas.forEach(function (item) {
                        innerHTML += `<td style="">本日無門診</td>`;
                    });
                    innerHTML += `</tr>`;
                }

                appointmentTable.html(innerHTML);

                // 取得預約資料並設定
                $.ajax({
                    type: 'POST',
                    url: '/Home/SetAppointmentData',
                    datatype: "json",
                    data: { "currentYear": currentYear, "currentMonth": currentMonth + 1, "currentDay": currentDay },
                    success: function (data) {
                        console.log(data);

                        data.forEach(function (item) {
                            let tdName = $('#' + item.doctorId + '-' + item.bookingBeginTime.toString().replace(':', '') + '')
                            let divHTML = ``;

                            divHTML += `<div class="event" onclick="appointmentOnClick('` + item.appointmentId + `');" style="height:` + (96) * (item.timeUnitCount) + `%">`;

                            divHTML += `<div class="appointmentTime">` + item.bookingBeginTime + `-` + item.bookingEndTime + `<br />病歷號:` + item.customerData.medicalRecordNumber + `<br /><p> 姓名:` + item.customerData.name + `-` + item.customerData.gender + `</p></div>`;
                            item.treatmentData.forEach(function (x) {
                                divHTML += `<div class="treatmentItem">` + x.treatmentName + `</div>`;
                            });
                            divHTML += `</div>`;

                            tdName.html(divHTML);
                        });
                    }
                });
            }
        });
    }

    // function setAppointmentTable(currentYear, currentMonth, currentDay) {
    //     $.ajax({
    //         type: 'POST',
    //         url: '/Home/SetAppointmentTable',
    //         datatype: "json",
    //         data: { "currentYear": currentYear, "currentMonth": currentMonth + 1, "currentDay": currentDay },
    //         success: function (data) {
    //             console.log(data)
    //             let appointmentTable = $('.appointmentTable');
    //             let innerHTML = ``;
    //             let outpatientCount = data.outpatientTimeDatas.length;

    //             設定table header
    //             innerHTML += `<tr>`;
    //             innerHTML += `<th class="tableHeader"></th>`;
    //             if (data.outpatientTimeDatas.length > 0) {
    //                 data.outpatientTimeDatas.forEach(function (item) {
    //                     innerHTML += `<th class="tableHeader">` + item.beginTime + `</th>`;
    //                 });
    //             } else
    //                 innerHTML += `<th class="tableHeader"></th>`;
    //             innerHTML += `</tr>`;

    //             設定醫師門診資料
    //             data.doctorDatas.forEach(function (item) {
    //                 innerHTML += `<tr>`;
    //                 innerHTML += `<td class="doctor-td">` + item.doctorName + `</td>`;

    //                 醫師各個時段的格子
    //                 if (data.outpatientTimeDatas.length > 0) {
    //                     data.outpatientTimeDatas.forEach(function (x) {
    //                         innerHTML += `<td id="` + item.doctorId + `-` + x.beginTime.toString().replace(':', '') + `"></td>`;
    //                     });
    //                 }
    //                 else
    //                     innerHTML += `<td style="">本日無門診</td>`;

    //                 innerHTML += `</tr>`;
    //             });

    //             appointmentTable.html(innerHTML);

    //             取得預約資料並設定
    //             $.ajax({
    //                 type: 'POST',
    //                 url: '/Home/SetAppointmentData',
    //                 datatype: "json",
    //                 data: { "currentYear": currentYear, "currentMonth": currentMonth + 1, "currentDay": currentDay },
    //                 success: function (data) {
    //                     console.log(data);

    //                     data.forEach(function (item) {
    //                         let tdName = $('#' + item.doctorId + '-' + item.bookingBeginTime.toString().replace(':', '') + '')
    //                         let divHTML = ``;

    //                         divHTML += `<div class="event" onclick="appointmentOnClick('` + item.appointmentId + `');" style="right:` + (-101) * (item.timeUnitCount - 1) + `%">`;

    //                         divHTML += `<div class="appointmentTime">` + item.bookingBeginTime + `-` + item.bookingEndTime + `<br />病歷號:` + item.customerData.medicalRecordNumber + `<br /><p> 姓名:` + item.customerData.name + `-` + item.customerData.gender + `</p></div>`;
    //                         item.treatmentData.forEach(function (x) {
    //                             divHTML += `<div class="treatmentItem">` + x.treatmentName + `</div>`;
    //                         });
    //                         divHTML += `</div>`;

    //                         tdName.html(divHTML);
    //                     });
    //                 }
    //             });
    //         }
    //     });
    // }

    function appointmentCheckIn() {
        let Id = $('#selectedAppointment').val();

        $.ajax({
            type: 'POST',
            url: '/Home/appointmentCheckIn',
            datatype: "json",
            data: { "appointmentId": Id },
            success: function (data) {
                console.log("Check in success.");

                $('#checkIn').html('<button class="btn sidebarbtn" disabled>已報到</button>');
            }
        });
    }

    function editAppointment() {
        let appointmentId = $('#selectedAppointment').val();

        window.location.href = "/Home/AppointmentEdit?id=" + encodeURIComponent(appointmentId);
    }

    function appointmentCancel() {
        if (confirm("確定要取消這筆預約嗎?")) {
            let Id = $('#selectedAppointment').val();

            $.ajax({
                type: 'POST',
                url: '/Home/appointmentCancel',
                datatype: "json",
                data: { "appointmentId": Id },
                success: function (data) {
                    console.log("Appointment cancel success.");

                    $('#selectedAppointment').val("");
                    $('.userinfo-sidebar').hide();
                    setAppointmentTable(currentYear, currentMonth, currentDay);
                }
            });
        }
    }

    function showTreatmentSelectMenu() {
        if ($('#treatmentSelectMenu'))
            $('#treatmentSelectMenu').toggle();
    }

    function setTreatmentList(i) {
        let treatments = [];

        $("label.active input[id^='tl-']").each(function () {
            treatments.push($(this).val().split(","));
        });

        if (treatments.length === 0) {
            $(".treatment-item").show();
        } else {
            let intersection = treatments.reduce((a, b) => a.filter(c => b.includes(c)));

            $(".treatment-item").hide();

            intersection.forEach(function (id) {
                $(`#${id}`).closest('.treatment-item').show();
            });
        }
    }

    function saveSelectedTreatment() {
        let Id = $('#selectedAppointment').val();
        let selectedTreatments = [];

        $("input[name='treatments']:checked").each(function () {
            selectedTreatments.push($(this).val());
        });

        $.ajax({
            type: 'POST',
            url: '/Home/saveSelectedTreatment',
            datatype: "json",
            data: { "appointmentId": Id, treatments: selectedTreatments },
            success: function (data) {
                console.log("Save actual treatment success.");

                if ($('#treatmentSelectMenu'))
                    $('#treatmentSelectMenu').toggle();

                appointmentOnClick(Id)
            }
        });
    }

    function refreshTable() {
        let [year, month, day] = $('#currentDate').val().split('-');

        currentYear = parseInt(year);
        currentMonth = parseInt(month - 1);
        currentDay = parseInt(day);

        console.log(currentYear);
        console.log(currentMonth);
        console.log(currentDay);

        document.getElementById

        setAppointmentTable(currentYear, currentMonth, currentDay);
    }



</script>